<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pencatatan Keuangan Harian</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
    body { font-family: 'Inter', sans-serif; }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-violet-600 via-fuchsia-600 to-indigo-700 text-gray-900">
  <!-- Top Bar -->
  <header class="sticky top-0 z-30 backdrop-blur supports-[backdrop-filter]:bg-white/10 bg-white/10 border-b border-white/20">
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="h-10 w-10 rounded-xl bg-white/20 flex items-center justify-center shadow-inner">
          <span class="text-2xl">üí∞</span>
        </div>
        <div>
          <h1 class="text-white text-lg md:text-xl font-extrabold tracking-tight">Pencatatan Keuangan</h1>
          <p class="text-white/80 text-xs md:text-sm">Cepat, rapi, dan mudah dipahami</p>
        </div>
      </div>
      <a href="#riwayat" class="hidden md:inline-flex text-white/90 hover:text-white text-sm font-medium transition">Riwayat</a>
    </div>
  </header>

  <!-- Main -->
  <main class="max-w-7xl mx-auto px-4 py-8 md:py-12">
    <!-- Hero -->
    <section class="mb-8 md:mb-12">
      <div class="rounded-3xl p-6 md:p-10 bg-white/10 border border-white/20 shadow-2xl">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-6">
          <div>
            <h2 class="text-2xl md:text-4xl font-extrabold text-white leading-tight">
              Atur uang Anda tanpa ribet
            </h2>
            <p class="text-white/85 mt-3 md:mt-4">
              Catat pemasukan dan pengeluaran, pantau grafik, dan lihat ringkasan secara instan.
            </p>
          </div>
          <div class="flex items-center gap-3">
            <div class="px-4 py-2 rounded-xl bg-white text-violet-700 font-semibold shadow hover:shadow-md transition">
              Siap digunakan
            </div>
            <div class="px-4 py-2 rounded-xl bg-white/20 text-white font-semibold border border-white/30">
              Real‚Äëtime ringkasan
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Summary Cards -->
    <section class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
      <div class="bg-white rounded-2xl shadow-xl p-6 border border-gray-100">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm font-medium text-gray-600">Total Pemasukan</p>
            <p id="totalIncome" class="text-3xl font-extrabold text-emerald-600 mt-1">Rp 0</p>
          </div>
          <div class="h-12 w-12 rounded-xl bg-emerald-50 text-emerald-600 flex items-center justify-center text-2xl">üìà</div>
        </div>
      </div>

      <div class="bg-white rounded-2xl shadow-xl p-6 border border-gray-100">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm font-medium text-gray-600">Total Pengeluaran</p>
            <p id="totalExpense" class="text-3xl font-extrabold text-rose-600 mt-1">Rp 0</p>
          </div>
          <div class="h-12 w-12 rounded-xl bg-rose-50 text-rose-600 flex items-center justify-center text-2xl">üìâ</div>
        </div>
      </div>

      <div class="bg-white rounded-2xl shadow-xl p-6 border border-gray-100">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm font-medium text-gray-600">Saldo</p>
            <p id="balance" class="text-3xl font-extrabold text-indigo-600 mt-1">Rp 0</p>
          </div>
          <div class="h-12 w-12 rounded-xl bg-indigo-50 text-indigo-600 flex items-center justify-center text-2xl">üí≥</div>
        </div>
      </div>
    </section>

    <!-- Form + Laporan -->
    <section class="grid grid-cols-1 lg:grid-cols-2 gap-8">
      <!-- Form Transaksi -->
      <div class="bg-white rounded-2xl shadow-xl p-6 md:p-7 border border-gray-100">
        <div class="flex items-center justify-between mb-6">
          <h3 class="text-xl md:text-2xl font-bold text-gray-800 flex items-center gap-2">
            <span>üìù</span> Input Transaksi
          </h3>
          <span class="text-xs px-2 py-1 rounded-lg bg-gray-100 text-gray-600">Form</span>
        </div>

        <form id="transactionForm" class="space-y-5">
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">Tanggal</label>
            <input id="date" type="date" required
              class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:ring-4 focus:ring-violet-200 focus:border-violet-500 outline-none transition"/>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Tipe</label>
              <select id="type" required
                class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:ring-4 focus:ring-violet-200 focus:border-violet-500 outline-none transition">
                <option value="">Pilih Tipe</option>
                <option value="income">Pemasukan</option>
                <option value="expense">Pengeluaran</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Kategori</label>
              <select id="category" required
                class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:ring-4 focus:ring-violet-200 focus:border-violet-500 outline-none transition">
                <option value="">Pilih Kategori</option>
              </select>
            </div>
          </div>

          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">Jumlah (Rp)</label>
            <input id="amount" type="number" min="1" step="0.01" placeholder="0" required
              class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:ring-4 focus:ring-violet-200 focus:border-violet-500 outline-none transition"/>
          </div>

          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">Catatan</label>
            <textarea id="notes" rows="3" placeholder="Catatan opsional..."
              class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:ring-4 focus:ring-violet-200 focus:border-violet-500 outline-none transition"></textarea>
          </div>

          <button type="submit"
            class="w-full py-3.5 rounded-xl font-semibold text-white bg-gradient-to-r from-violet-600 to-fuchsia-600 hover:from-violet-700 hover:to-fuchsia-700 shadow-lg shadow-fuchsia-500/25 transition transform hover:scale-[1.01]">
            üíæ Simpan Transaksi
          </button>
        </form>
      </div>

      <!-- Laporan -->
      <div class="bg-white rounded-2xl shadow-xl p-6 md:p-7 border border-gray-100">
        <div class="flex items-center justify-between mb-6">
          <h3 class="text-xl md:text-2xl font-bold text-gray-800 flex items-center gap-2">
            <span>üìä</span> Laporan Keuangan
          </h3>
          <span class="text-xs px-2 py-1 rounded-lg bg-gray-100 text-gray-600">Grafik</span>
        </div>

        <div class="mb-4">
          <select id="reportPeriod"
            class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:ring-4 focus:ring-violet-200 focus:border-violet-500 outline-none transition">
            <option value="daily">Harian</option>
            <option value="weekly">Mingguan</option>
            <option value="monthly">Bulanan</option>
            <option value="yearly">Tahunan</option>
          </select>
        </div>

        <div class="mb-6">
          <canvas id="reportChart" width="400" height="200"></canvas>
        </div>

        <div id="reportSummary" class="space-y-3"></div>
      </div>
    </section>

    <!-- Riwayat -->
    <section id="riwayat" class="mt-10 bg-white rounded-2xl shadow-xl p-6 md:p-7 border border-gray-100">
      <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6">
        <h3 class="text-xl md:text-2xl font-bold text-gray-800 flex items-center gap-2">
          <span>üìã</span> Riwayat Transaksi
        </h3>
        <button id="clearAllBtn"
          class="px-4 py-2.5 rounded-xl font-semibold text-white bg-rose-600 hover:bg-rose-700 shadow transition">
          üóëÔ∏è Hapus Semua
        </button>
      </div>

      <!-- Filter Tanggal -->
      <div class="mb-6 rounded-xl border border-gray-200 bg-gray-50 p-4">
        <h4 class="text-base font-semibold text-gray-800 mb-4 flex items-center gap-2">
          <span>üîç</span> Filter Tanggal
        </h4>
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Dari</label>
            <input id="filterStartDate" type="date"
              class="w-full px-3 py-2 rounded-lg border border-gray-300 focus:ring-4 focus:ring-violet-200 focus:border-violet-500 outline-none transition"/>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Sampai</label>
            <input id="filterEndDate" type="date"
              class="w-full px-3 py-2 rounded-lg border border-gray-300 focus:ring-4 focus:ring-violet-200 focus:border-violet-500 outline-none transition"/>
          </div>
          <div class="flex items-end">
            <button id="filterBtn"
              class="w-full px-4 py-2.5 rounded-xl font-semibold text-white bg-violet-600 hover:bg-violet-700 shadow transition">
              üîé Filter
            </button>
          </div>
          <div class="flex items-end">
            <button id="resetFilterBtn"
              class="w-full px-4 py-2.5 rounded-xl font-semibold text-gray-800 bg-gray-200 hover:bg-gray-300 shadow transition">
              üîÑ Reset
            </button>
          </div>
        </div>
      </div>

      <div class="overflow-x-auto rounded-xl border border-gray-200">
        <table class="w-full text-left">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-4 py-3 text-sm font-semibold text-gray-700">Tanggal</th>
              <th class="px-4 py-3 text-sm font-semibold text-gray-700">Tipe</th>
              <th class="px-4 py-3 text-sm font-semibold text-gray-700">Kategori</th>
              <th class="px-4 py-3 text-sm font-semibold text-gray-700">Jumlah</th>
              <th class="px-4 py-3 text-sm font-semibold text-gray-700">Catatan</th>
              <th class="px-4 py-3 text-sm font-semibold text-gray-700">Aksi</th>
            </tr>
          </thead>
          <tbody id="transactionHistory" class="divide-y divide-gray-100"></tbody>
        </table>
      </div>
    </section>
  </main>

  <!-- Modal Edit -->
  <div id="editModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-2xl shadow-2xl p-6 md:p-7 w-full max-w-md mx-4">
      <div class="flex justify-between items-center mb-6">
        <h3 class="text-xl font-bold text-gray-800">‚úèÔ∏è Edit Transaksi</h3>
        <button id="closeEditModal" class="text-gray-500 hover:text-gray-700 text-2xl leading-none">√ó</button>
      </div>

      <form id="editTransactionForm" class="space-y-5">
        <input type="hidden" id="editTransactionId"/>

        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">Tanggal</label>
          <input id="editDate" type="date" required
            class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:ring-4 focus:ring-violet-200 focus:border-violet-500 outline-none transition"/>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">Tipe</label>
            <select id="editType" required
              class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:ring-4 focus:ring-violet-200 focus:border-violet-500 outline-none transition">
              <option value="">Pilih Tipe</option>
              <option value="income">Pemasukan</option>
              <option value="expense">Pengeluaran</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">Kategori</label>
            <select id="editCategory" required
              class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:ring-4 focus:ring-violet-200 focus:border-violet-500 outline-none transition">
              <option value="">Pilih Kategori</option>
            </select>
          </div>
        </div>

        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">Jumlah (Rp)</label>
          <input id="editAmount" type="number" min="1" step="0.01" required
            class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:ring-4 focus:ring-violet-200 focus:border-violet-500 outline-none transition"/>
        </div>

        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">Catatan</label>
          <textarea id="editNotes" rows="3" placeholder="Catatan opsional..."
            class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:ring-4 focus:ring-violet-200 focus:border-violet-500 outline-none transition"></textarea>
        </div>

        <div class="flex gap-3 pt-2">
          <button type="submit"
            class="flex-1 py-2.5 rounded-xl font-semibold text-white bg-gradient-to-r from-violet-600 to-fuchsia-600 hover:from-violet-700 hover:to-fuchsia-700 shadow transition">
            üíæ Simpan Perubahan
          </button>
          <button type="button" id="cancelEdit"
            class="flex-1 py-2.5 rounded-xl font-semibold bg-gray-200 hover:bg-gray-300 text-gray-800 transition">
            ‚ùå Batal
          </button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // IndexedDB setup
    let db;
    const dbName = 'FinanceTracker';
    const dbVersion = 1;

    const categories = {
      income: ['Gaji', 'Bonus', 'Investasi', 'Bisnis', 'Lainnya'],
      expense: ['Makanan', 'Transportasi', 'Belanja', 'Tagihan', 'Hiburan', 'Kesehatan', 'Lainnya']
    };

    function initDB() {
      const request = indexedDB.open(dbName, dbVersion);
      request.onerror = (e) => console.error('Database error:', e.target.error);
      request.onupgradeneeded = (e) => {
        db = e.target.result;
        const store = db.createObjectStore('transactions', { keyPath: 'id', autoIncrement: true });
        store.createIndex('date', 'date', { unique: false });
        store.createIndex('type', 'type', { unique: false });
      };
      request.onsuccess = (e) => {
        db = e.target.result;
        loadTransactions();
        updateSummary();
        updateReport();
      };
    }

    function saveTransaction(t) {
      db.transaction(['transactions'], 'readwrite')
        .objectStore('transactions').add(t).onsuccess = () => {
          loadTransactions(); updateSummary(); updateReport();
        };
    }

    function updateTransaction(id, t) {
      db.transaction(['transactions'], 'readwrite')
        .objectStore('transactions').put({ ...t, id }).onsuccess = () => {
          loadTransactions(); updateSummary(); updateReport(); closeEditModal();
        };
    }

    function deleteTransaction(id) {
      db.transaction(['transactions'], 'readwrite')
        .objectStore('transactions').delete(id).onsuccess = () => {
          loadTransactions(); updateSummary(); updateReport();
        };
    }

    function clearAllTransactions() {
      if (!confirm('Apakah Anda yakin ingin menghapus semua transaksi?')) return;
      db.transaction(['transactions'], 'readwrite')
        .objectStore('transactions').clear().onsuccess = () => {
          loadTransactions(); updateSummary(); updateReport();
        };
    }

    function loadTransactions(filtered = null) {
      if (filtered) { displayTransactions(filtered); return; }
      db.transaction(['transactions'], 'readonly')
        .objectStore('transactions').getAll().onsuccess = (e) => {
          displayTransactions(e.target.result);
        };
    }

    function filterTransactions() {
      const start = document.getElementById('filterStartDate').value;
      const end = document.getElementById('filterEndDate').value;
      db.transaction(['transactions'], 'readonly')
        .objectStore('transactions').getAll().onsuccess = (e) => {
          let txs = e.target.result || [];
          if (start) txs = txs.filter(t => t.date >= start);
          if (end) txs = txs.filter(t => t.date <= end);
          displayTransactions(txs);
        };
    }

    function resetFilter() {
      document.getElementById('filterStartDate').value = '';
      document.getElementById('filterEndDate').value = '';
      loadTransactions();
    }

    function displayTransactions(transactions) {
      const tbody = document.getElementById('transactionHistory');
      tbody.innerHTML = '';
      (transactions || []).sort((a, b) => new Date(b.date) - new Date(a.date))
        .forEach(t => {
          const typeClass = t.type === 'income' ? 'text-emerald-600' : 'text-rose-600';
          const typeIcon = t.type === 'income' ? 'üìà' : 'üìâ';
          const tr = document.createElement('tr');
          tr.className = 'hover:bg-gray-50';
          tr.innerHTML = `
            <td class="px-4 py-3 text-sm text-gray-700">${new Date(t.date).toLocaleDateString('id-ID')}</td>
            <td class="px-4 py-3 text-sm ${typeClass} font-semibold">${typeIcon} ${t.type === 'income' ? 'Pemasukan' : 'Pengeluaran'}</td>
            <td class="px-4 py-3 text-sm text-gray-700">${t.category}</td>
            <td class="px-4 py-3 text-sm font-extrabold ${typeClass}">Rp ${t.amount.toLocaleString('id-ID')}</td>
            <td class="px-4 py-3 text-sm text-gray-600">${t.notes || '-'}</td>
            <td class="px-4 py-3 text-sm">
              <button class="text-violet-700 hover:text-violet-900 font-semibold mr-3" onclick="editTransaction(${t.id})">‚úèÔ∏è Edit</button>
              <button class="text-rose-600 hover:text-rose-800 font-semibold" onclick="deleteTransaction(${t.id})">üóëÔ∏è Hapus</button>
            </td>
          `;
          tbody.appendChild(tr);
        });
    }

    function editTransaction(id) {
      db.transaction(['transactions'], 'readonly')
        .objectStore('transactions').get(id).onsuccess = (e) => {
          const t = e.target.result; if (!t) return;
          document.getElementById('editTransactionId').value = t.id;
          document.getElementById('editDate').value = t.date;
          document.getElementById('editType').value = t.type;
          document.getElementById('editAmount').value = t.amount;
          document.getElementById('editNotes').value = t.notes || '';
          updateEditCategories();
          setTimeout(() => { document.getElementById('editCategory').value = t.category; }, 50);
          openEditModal();
        };
    }

    function openEditModal() {
      const modal = document.getElementById('editModal');
      modal.classList.remove('hidden'); modal.classList.add('flex');
    }

    function closeEditModal() {
      const modal = document.getElementById('editModal');
      modal.classList.add('hidden'); modal.classList.remove('flex');
      document.getElementById('editTransactionForm').reset();
    }

    function updateCategories() {
      const type = document.getElementById('type').value;
      const sel = document.getElementById('category');
      sel.innerHTML = '<option value="">Pilih Kategori</option>';
      if (type && categories[type]) {
        categories[type].forEach(c => {
          const o = document.createElement('option');
          o.value = c; o.textContent = c; sel.appendChild(o);
        });
      }
    }

    function updateEditCategories() {
      const type = document.getElementById('editType').value;
      const sel = document.getElementById('editCategory');
      sel.innerHTML = '<option value="">Pilih Kategori</option>';
      if (type && categories[type]) {
        categories[type].forEach(c => {
          const o = document.createElement('option');
          o.value = c; o.textContent = c; sel.appendChild(o);
        });
      }
    }

    function updateSummary() {
      db.transaction(['transactions'], 'readonly')
        .objectStore('transactions').getAll().onsuccess = (e) => {
          const txs = e.target.result || [];
          const income = txs.filter(t => t.type === 'income').reduce((s, t) => s + t.amount, 0);
          const expense = txs.filter(t => t.type === 'expense').reduce((s, t) => s + t.amount, 0);
          const balance = income - expense;
          document.getElementById('totalIncome').textContent = `Rp ${income.toLocaleString('id-ID')}`;
          document.getElementById('totalExpense').textContent = `Rp ${expense.toLocaleString('id-ID')}`;
          const balanceEl = document.getElementById('balance');
          balanceEl.textContent = `Rp ${balance.toLocaleString('id-ID')}`;
          balanceEl.className = `text-3xl font-extrabold ${balance >= 0 ? 'text-emerald-600' : 'text-rose-600'} mt-1`;
        };
    }

    let reportChart;
    function updateReport() {
      const period = document.getElementById('reportPeriod').value;
      db.transaction(['transactions'], 'readonly')
        .objectStore('transactions').getAll().onsuccess = (e) => {
          const txs = e.target.result || [];
          const data = buildReportData(txs, period);
          renderChart(data);
          renderReportSummary(data);
        };
    }

    function buildReportData(transactions, period) {
      const now = new Date();
      const data = {};
      transactions.forEach(t => {
        const d = new Date(t.date); let key;
        if (period === 'daily') {
          if (d.toDateString() !== now.toDateString()) return;
          key = 'Hari Ini';
        } else if (period === 'weekly') {
          const start = new Date(now); start.setDate(now.getDate() - now.getDay());
          if (d < start) return; key = 'Minggu Ini';
        } else if (period === 'monthly') {
          if (d.getMonth() !== now.getMonth() || d.getFullYear() !== now.getFullYear()) return;
          key = 'Bulan Ini';
        } else {
          if (d.getFullYear() !== now.getFullYear()) return;
          key = 'Tahun Ini';
        }
        if (!data[key]) data[key] = { income: 0, expense: 0 };
        data[key][t.type] += t.amount;
      });
      return data;
    }

    function renderChart(data) {
      const ctx = document.getElementById('reportChart').getContext('2d');
      if (reportChart) reportChart.destroy();
      const labels = Object.keys(data);
      const incomeData = labels.map(l => data[l].income || 0);
      const expenseData = labels.map(l => data[l].expense || 0);
      reportChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels,
          datasets: [
            { label: 'Pemasukan', data: incomeData, backgroundColor: 'rgba(16,185,129,0.9)', borderRadius: 8 },
            { label: 'Pengeluaran', data: expenseData, backgroundColor: 'rgba(244,63,94,0.9)', borderRadius: 8 }
          ]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { labels: { color: '#111827', font: { family: 'Inter' } } },
            tooltip: { callbacks: { label: (ctx) => `${ctx.dataset.label}: Rp ${ctx.parsed.y.toLocaleString('id-ID')}` } }
          },
          scales: {
            x: { ticks: { color: '#6B7280' }, grid: { display: false } },
            y: {
              beginAtZero: true,
              ticks: {
                color: '#6B7280',
                callback: (v) => 'Rp ' + Number(v).toLocaleString('id-ID')
              },
              grid: { color: 'rgba(0,0,0,0.05)' }
            }
          }
        }
      });
    }

    function renderReportSummary(data) {
      const wrap = document.getElementById('reportSummary');
      wrap.innerHTML = '';
      Object.keys(data).forEach(k => {
        const income = data[k].income || 0;
        const expense = data[k].expense || 0;
        const balance = income - expense;
        const box = document.createElement('div');
        box.className = 'bg-gray-50 border border-gray-200 p-4 rounded-xl';
        box.innerHTML = `
          <h4 class="font-bold text-gray-800 mb-3">${k}</h4>
          <div class="grid grid-cols-3 gap-4 text-sm">
            <div><span class="text-emerald-600 font-semibold">üìà Pemasukan</span><p class="font-extrabold mt-1">Rp ${income.toLocaleString('id-ID')}</p></div>
            <div><span class="text-rose-600 font-semibold">üìâ Pengeluaran</span><p class="font-extrabold mt-1">Rp ${expense.toLocaleString('id-ID')}</p></div>
            <div><span class="text-indigo-600 font-semibold">üí≥ Saldo</span>
              <p class="font-extrabold mt-1 ${balance >= 0 ? 'text-emerald-600' : 'text-rose-600'}">Rp ${balance.toLocaleString('id-ID')}</p>
            </div>
          </div>
        `;
        wrap.appendChild(box);
      });
    }

    // Events
    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('date').valueAsDate = new Date();
      initDB();

      document.getElementById('transactionForm').addEventListener('submit', (e) => {
        e.preventDefault();
        const formData = {
          date: document.getElementById('date').value,
          type: document.getElementById('type').value,
          category: document.getElementById('category').value,
          amount: parseFloat(document.getElementById('amount').value),
          notes: document.getElementById('notes').value
        };
        if (!formData.type || !formData.category) { alert('Tipe dan kategori harus diisi!'); return; }
        if (formData.amount <= 0) { alert('Jumlah harus lebih dari 0!'); return; }
        saveTransaction(formData);
        e.target.reset();
        document.getElementById('date').valueAsDate = new Date();
        updateCategories();
        alert('Transaksi berhasil disimpan!');
      });

      document.getElementById('type').addEventListener('change', updateCategories);
      document.getElementById('reportPeriod').addEventListener('change', updateReport);
      document.getElementById('clearAllBtn').addEventListener('click', clearAllTransactions);
      document.getElementById('filterBtn').addEventListener('click', filterTransactions);
      document.getElementById('resetFilterBtn').addEventListener('click', resetFilter);

      document.getElementById('closeEditModal').addEventListener('click', closeEditModal);
      document.getElementById('cancelEdit').addEventListener('click', closeEditModal);
      document.getElementById('editType').addEventListener('change', updateEditCategories);
      document.getElementById('editModal').addEventListener('click', (e) => { if (e.target.id === 'editModal') closeEditModal(); });
    });
  </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98634deba1729de7',t:'MTc1OTA2MzE3NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
